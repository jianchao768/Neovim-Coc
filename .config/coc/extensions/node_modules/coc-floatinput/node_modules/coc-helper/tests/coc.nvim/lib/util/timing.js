'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTiming = void 0;
const logger_1 = require("../logger");
const logger = (0, logger_1.createLogger)('timing');
/**
 * Trace the duration and show error on timeout
 */
function createTiming(name, timeout) {
    let start;
    let timer;
    let _label;
    return {
        start(label) {
            _label = label;
            start = Date.now();
            clearTimeout(timer);
            if (timeout) {
                timer = setTimeout(() => {
                    logger.error(`${name} timeout after ${timeout}ms`);
                }, timeout);
                timer.unref();
            }
        },
        stop() {
            clearTimeout(timer);
            logger.trace(`${name}${_label ? ` ${_label}` : ''} cost:`, Date.now() - start);
        }
    };
}
exports.createTiming = createTiming;
//# sourceMappingURL=timing.js.map