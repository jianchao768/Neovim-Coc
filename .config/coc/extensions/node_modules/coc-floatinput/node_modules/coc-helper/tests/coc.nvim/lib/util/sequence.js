"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Sequence = void 0;
class Sequence {
    constructor() {
        this._busy = false;
        this._fns = [];
        this._resolves = [];
    }
    run(fn) {
        if (!this._busy) {
            this._busy = true;
            fn().finally(() => {
                this.next();
            });
        }
        else {
            this._fns.push(fn);
        }
    }
    waitFinish() {
        if (!this._busy)
            return Promise.resolve();
        return new Promise(resolve => {
            this._resolves.push(resolve);
        });
    }
    next() {
        let fn = this._fns.shift();
        if (!fn) {
            this.finish();
        }
        else {
            fn().finally(() => {
                this.next();
            });
        }
    }
    finish() {
        this._busy = false;
        let fn;
        while ((fn = this._resolves.pop()) != null) {
            fn();
        }
    }
    cancel() {
        this._fns = [];
        this.finish();
    }
}
exports.Sequence = Sequence;
//# sourceMappingURL=sequence.js.map